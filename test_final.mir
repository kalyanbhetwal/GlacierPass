--- |
  ; ModuleID = 'test_after_prologue.mir'
  source_filename = "test-files/test_both.c"
  target datalayout = "e-m:e-p:16:16-i32:16-i64:16-f32:16-f64:16-a:8-n8:16-S16"
  target triple = "msp430"
  
  @.str = private unnamed_addr constant [8 x i8] c"discard\00", section "llvm.metadata"
  @.str.1 = private unnamed_addr constant [23 x i8] c"test-files/test_both.c\00", section "llvm.metadata"
  @llvm.global.annotations = appending global [1 x { ptr, ptr, ptr, i32, ptr }] [{ ptr, ptr, ptr, i32, ptr } { ptr @discard_func, ptr @.str, ptr @.str.1, i32 2, ptr null }], section "llvm.metadata"
  
  define dso_local i16 @discard_func(i16 noundef %a, i16 noundef %b) #0 {
  entry:
    %a.addr = alloca i16, align 2
    %b.addr = alloca i16, align 2
    %x = alloca i16, align 2
    %y = alloca i16, align 2
    store i16 %a, ptr %a.addr, align 2
    store i16 %b, ptr %b.addr, align 2
    %0 = load i16, ptr %a.addr, align 2
    %1 = load i16, ptr %b.addr, align 2
    %add = add nsw i16 %0, %1
    store i16 %add, ptr %x, align 2
    %2 = load i16, ptr %x, align 2
    %mul = mul nsw i16 %2, 2
    store i16 %mul, ptr %y, align 2
    %3 = load i16, ptr %y, align 2
    %4 = load i16, ptr %a.addr, align 2
    %sub = sub nsw i16 %3, %4
    ret i16 %sub
  }
  
  define dso_local i16 @normal_func(i16 noundef %a, i16 noundef %b) #0 {
  entry:
    %a.addr = alloca i16, align 2
    %b.addr = alloca i16, align 2
    %x = alloca i16, align 2
    %y = alloca i16, align 2
    store i16 %a, ptr %a.addr, align 2
    store i16 %b, ptr %b.addr, align 2
    %0 = load i16, ptr %a.addr, align 2
    %1 = load i16, ptr %b.addr, align 2
    %add = add nsw i16 %0, %1
    store i16 %add, ptr %x, align 2
    %2 = load i16, ptr %x, align 2
    %mul = mul nsw i16 %2, 2
    store i16 %mul, ptr %y, align 2
    %3 = load i16, ptr %y, align 2
    %4 = load i16, ptr %b.addr, align 2
    %sub = sub nsw i16 %3, %4
    ret i16 %sub
  }
  
  define dso_local i16 @main() #0 {
  entry:
    %retval = alloca i16, align 2
    %r1 = alloca i16, align 2
    %r2 = alloca i16, align 2
    store i16 0, ptr %retval, align 2
    %call = call i16 @discard_func(i16 noundef 5, i16 noundef 10)
    store i16 %call, ptr %r1, align 2
    %call1 = call i16 @normal_func(i16 noundef 3, i16 noundef 7)
    store i16 %call1, ptr %r2, align 2
    %0 = load i16, ptr %r1, align 2
    %1 = load i16, ptr %r2, align 2
    %add = add nsw i16 %0, %1
    ret i16 %add
  }
  
  attributes #0 = { "discard" }
  
  !llvm.module.flags = !{!0}
  !llvm.ident = !{!1}
  
  !0 = !{i32 1, !"wchar_size", i32 2}
  !1 = !{!"clang version 22.0.0git (git@github.com:llvm/llvm-project.git 7e55a4c9937dfc2184636ad7f3c9f7eccfad6186)"}
...
---
name:            discard_func
alignment:       2
exposesReturnsTwice: false
legalized:       false
regBankSelected: false
selected:        false
failedISel:      false
tracksRegLiveness: true
hasWinCFI:       false
noPhis:          true
isSSA:           false
noVRegs:         true
hasFakeUses:     false
callsEHReturn:   false
callsUnwindInit: false
hasEHContTarget: false
hasEHScopes:     false
hasEHFunclets:   false
isOutlined:      false
debugInstrRef:   false
failsVerification: false
tracksDebugUserValues: true
registers:       []
liveins:
  - { reg: '$r12', virtual-reg: '' }
  - { reg: '$r13', virtual-reg: '' }
frameInfo:
  isFrameAddressTaken: false
  isReturnAddressTaken: false
  hasStackMap:     false
  hasPatchPoint:   false
  stackSize:       8
  offsetAdjustment: 0
  maxAlignment:    2
  adjustsStack:    false
  hasCalls:        false
  stackProtector:  ''
  functionContext: ''
  maxCallFrameSize: 0
  cvBytesOfCalleeSavedRegisters: 0
  hasOpaqueSPAdjustment: false
  hasVAStart:      false
  hasMustTailInVarArgFunc: false
  hasTailCall:     false
  isCalleeSavedInfoValid: true
  localFrameSize:  0
fixedStack:      []
stack:
  - { id: 0, name: a.addr, type: default, offset: -4, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
  - { id: 1, name: b.addr, type: default, offset: -6, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
  - { id: 2, name: x, type: default, offset: -8, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
  - { id: 3, name: y, type: default, offset: -10, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
entry_values:    []
callSites:       []
debugValueSubstitutions: []
constants:       []
machineFunctionInfo: {}
body:             |
  bb.0.entry:
    liveins: $r12, $r13
  
    frame-setup ANNOTATION_LABEL 48879
    frame-setup PUSH16i 48879, implicit-def $sp, implicit $sp
    $sp = frame-setup SUB16ri $sp, 8, implicit-def dead $sr
    frame-setup CFI_INSTRUCTION def_cfa_offset 10
    MOV16mr $sp, 4, $r13 :: (store (s16) into %ir.b.addr)
    MOV16mr $sp, 6, $r12 :: (store (s16) into %ir.a.addr)
    $r13 = nsw ADD16rr killed $r13, $r12, implicit-def dead $sr
    MOV16mr $sp, 2, $r13 :: (store (s16) into %ir.x)
    $r13 = ADD16rr killed $r13, $r13, implicit-def dead $sr
    MOV16mr $sp, 0, $r13 :: (store (s16) into %ir.y)
    $r13 = nsw SUB16rr killed $r13, killed $r12, implicit-def dead $sr
    $r12 = COPY killed $r13
    $sp = frame-destroy ADD16ri $sp, 8, implicit-def dead $sr
    frame-destroy CFI_INSTRUCTION def_cfa_offset 2
    $r15 = frame-destroy POP16r implicit-def $sp, implicit $sp
    RET implicit $r12
...
---
name:            normal_func
alignment:       2
exposesReturnsTwice: false
legalized:       false
regBankSelected: false
selected:        false
failedISel:      false
tracksRegLiveness: true
hasWinCFI:       false
noPhis:          true
isSSA:           false
noVRegs:         true
hasFakeUses:     false
callsEHReturn:   false
callsUnwindInit: false
hasEHContTarget: false
hasEHScopes:     false
hasEHFunclets:   false
isOutlined:      false
debugInstrRef:   false
failsVerification: false
tracksDebugUserValues: true
registers:       []
liveins:
  - { reg: '$r12', virtual-reg: '' }
  - { reg: '$r13', virtual-reg: '' }
frameInfo:
  isFrameAddressTaken: false
  isReturnAddressTaken: false
  hasStackMap:     false
  hasPatchPoint:   false
  stackSize:       8
  offsetAdjustment: 0
  maxAlignment:    2
  adjustsStack:    false
  hasCalls:        false
  stackProtector:  ''
  functionContext: ''
  maxCallFrameSize: 0
  cvBytesOfCalleeSavedRegisters: 0
  hasOpaqueSPAdjustment: false
  hasVAStart:      false
  hasMustTailInVarArgFunc: false
  hasTailCall:     false
  isCalleeSavedInfoValid: true
  localFrameSize:  0
fixedStack:      []
stack:
  - { id: 0, name: a.addr, type: default, offset: -4, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
  - { id: 1, name: b.addr, type: default, offset: -6, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
  - { id: 2, name: x, type: default, offset: -8, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
  - { id: 3, name: y, type: default, offset: -10, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
entry_values:    []
callSites:       []
debugValueSubstitutions: []
constants:       []
machineFunctionInfo: {}
body:             |
  bb.0.entry:
    liveins: $r12, $r13
  
    frame-setup ANNOTATION_LABEL 48879
    frame-setup PUSH16i 48879, implicit-def $sp, implicit $sp
    $sp = frame-setup SUB16ri $sp, 8, implicit-def dead $sr
    frame-setup CFI_INSTRUCTION def_cfa_offset 10
    MOV16mr $sp, 4, $r13 :: (store (s16) into %ir.b.addr)
    MOV16mr $sp, 6, $r12 :: (store (s16) into %ir.a.addr)
    $r12 = nsw ADD16rr killed $r12, $r13, implicit-def dead $sr
    MOV16mr $sp, 2, $r12 :: (store (s16) into %ir.x)
    $r12 = ADD16rr killed $r12, $r12, implicit-def dead $sr
    MOV16mr $sp, 0, $r12 :: (store (s16) into %ir.y)
    $r12 = nsw SUB16rr killed $r12, killed $r13, implicit-def dead $sr
    $sp = frame-destroy ADD16ri $sp, 8, implicit-def dead $sr
    frame-destroy CFI_INSTRUCTION def_cfa_offset 2
    $r15 = frame-destroy POP16r implicit-def $sp, implicit $sp
    RET implicit $r12
...
---
name:            main
alignment:       2
exposesReturnsTwice: false
legalized:       false
regBankSelected: false
selected:        false
failedISel:      false
tracksRegLiveness: true
hasWinCFI:       false
noPhis:          true
isSSA:           false
noVRegs:         true
hasFakeUses:     false
callsEHReturn:   false
callsUnwindInit: false
hasEHContTarget: false
hasEHScopes:     false
hasEHFunclets:   false
isOutlined:      false
debugInstrRef:   false
failsVerification: false
tracksDebugUserValues: true
registers:       []
liveins:         []
frameInfo:
  isFrameAddressTaken: false
  isReturnAddressTaken: false
  hasStackMap:     false
  hasPatchPoint:   false
  stackSize:       6
  offsetAdjustment: 0
  maxAlignment:    2
  adjustsStack:    true
  hasCalls:        true
  stackProtector:  ''
  functionContext: ''
  maxCallFrameSize: 0
  cvBytesOfCalleeSavedRegisters: 0
  hasOpaqueSPAdjustment: false
  hasVAStart:      false
  hasMustTailInVarArgFunc: false
  hasTailCall:     false
  isCalleeSavedInfoValid: true
  localFrameSize:  0
fixedStack:      []
stack:
  - { id: 0, name: retval, type: default, offset: -4, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
  - { id: 1, name: r1, type: default, offset: -6, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
  - { id: 2, name: r2, type: default, offset: -8, size: 2, alignment: 2, 
      stack-id: default, callee-saved-register: '', callee-saved-restored: true, 
      debug-info-variable: '', debug-info-expression: '', debug-info-location: '' }
entry_values:    []
callSites:       []
debugValueSubstitutions: []
constants:       []
machineFunctionInfo: {}
body:             |
  bb.0.entry:
    frame-setup ANNOTATION_LABEL 48879
    frame-setup PUSH16i 48879, implicit-def $sp, implicit $sp
    $sp = frame-setup SUB16ri $sp, 6, implicit-def dead $sr
    frame-setup CFI_INSTRUCTION def_cfa_offset 8
    MOV16mc $sp, 4, 0 :: (store (s16) into %ir.retval)
    $r12 = MOV16ri 5
    $r13 = MOV16ri 10
    CALLi @discard_func, implicit-def dead $r11, implicit-def $r12, implicit-def dead $r13, implicit-def dead $r14, implicit-def dead $r15, implicit-def dead $sr, implicit $sp, implicit $r12, implicit killed $r13
    MOV16mr $sp, 2, killed $r12 :: (store (s16) into %ir.r1)
    $r12 = MOV16ri 3
    $r13 = MOV16ri 7
    CALLi @normal_func, implicit-def dead $r11, implicit-def $r12, implicit-def dead $r13, implicit-def dead $r14, implicit-def dead $r15, implicit-def dead $sr, implicit $sp, implicit $r12, implicit killed $r13
    MOV16mr $sp, 0, $r12 :: (store (s16) into %ir.r2)
    $r12 = nsw ADD16rm killed $r12, $sp, 2, implicit-def dead $sr :: (dereferenceable load (s16) from %ir.r1)
    $sp = frame-destroy ADD16ri $sp, 6, implicit-def dead $sr
    frame-destroy CFI_INSTRUCTION def_cfa_offset 2
    $r15 = frame-destroy POP16r implicit-def $sp, implicit $sp
    RET implicit $r12
...
